<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å­¦ç¨‹é€š - å­¦ä¹ è®¡åˆ’ç”Ÿæˆå·¥å…·</title>

  <!-- å¤–éƒ¨å›¾æ ‡åº“ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- æ‰€æœ‰ CSS æ ·å¼å†™åœ¨è¿™é‡Œ -->
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
          margin: 0;
          padding: 0;
          min-height: 100vh;
          font-family: 'Segoe UI', sans-serif;
          background: linear-gradient(135deg, #a1c4fd, #c2e9fb);
          padding-top: 80px; /* ä¸ºå›ºå®šå¯¼èˆªæ ç•™å‡ºç©ºé—´ */
          overflow-x: hidden; /* éšè—æ¨ªå‘æ»šåŠ¨æ¡ */
        }
        
        .container {
          max-width: 1200px;
          margin: 0 auto;
          padding: 20px;
          display: flex;              /* å¯ç”¨Flexå¸ƒå±€ */
          flex-direction: column;     /* å‚ç›´æ’åˆ—å­å…ƒç´  */
          align-items: center;        /* æ°´å¹³å±…ä¸­ */
        }
        
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
        }
        
        nav {
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            padding: 0 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        nav:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            height: 80px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }
        
        .logo-icon {
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            box-shadow: 0 4px 10px rgba(75, 108, 183, 0.3);
        }
        
        .logo-text {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #182848 0%, #4b6cb7 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }
        
        .nav-links {
            display: flex;
            gap: 15px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 24px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 16px;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }
        
        .nav-link i {
            margin-right: 10px;
            font-size: 18px;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(0, 0, 0, 0.1);
        }
        
        .nav-link:hover i {
            transform: scale(1.2);
        }
        
        .nav-link.home {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            color: #1565c0;
            border: 2px solid #90caf9;
        }
        
        .nav-link.focus {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            color: #2e7d32;
            border: 2px solid #a5d6a7;
        }
        
        .nav-link.report {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            color: #ef6c00;
            border: 2px solid #ffcc80;
        }
        
        .nav-link.plan {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            color: #7b1fa2;
            border: 2px solid #ce93d8;
        }
        
        .nav-link.login {
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(75, 108, 183, 0.4);
        }
        
        .nav-link.login:hover {
            box-shadow: 0 7px 20px rgba(75, 108, 183, 0.6);
        }
        
        /* å†…å®¹åŒºåŸŸ */
        .hero {
            text-align: center;
            padding: 60px 20px;
            margin: 30px 0;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.7);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(10px);
        }
        
        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #182848 0%, #4b6cb7 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .hero p {
            font-size: 1.3rem;
            max-width: 700px;
            margin: 0 auto 30px;
            color: #555;
            line-height: 1.7;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 50px;
        }
        
        .feature-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            text-align: center;
            border: 1px solid rgba(0, 0, 0, 0.03);
        }
        
        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }
        
        .feature-card i {
            font-size: 50px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .feature-card h3 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: #182848;
        }
        
        .feature-card p {
            color: #666;
            line-height: 1.6;
        }
        
        .mobile-toggle {
            display: none;
            font-size: 24px;
            color: #182848;
            cursor: pointer;
        }
        
        @media (max-width: 992px) {
            .nav-links {
                display: none;
            }
            
            .mobile-toggle {
                display: block;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .hero p {
                font-size: 1.1rem;
            }
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .logo-icon {
            animation: float 4s ease-in-out infinite;
        }
        
        .nav-link {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }


    /* æ¨¡ç³Šç»ç’ƒå¡ç‰‡å®¹å™¨ */
    .form-container {
      margin: 40px auto;
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      padding: 40px 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      max-width: 500px;
      width: 90%;
      margin-bottom: 40px;
    }

    .form-wrapper {
      display: flex;
      justify-content: center; /* æ°´å¹³å±…ä¸­ */
      align-items: center;
      min-height:  calc(100vh - å¯¼èˆªæ é«˜åº¦ç­‰);
    }

    .title {
      font-size: 1.8em;
      margin-bottom: 25px;
      text-align: center;
      color: #1e3a8a;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      font-weight: 600;
      color: #374151;
      margin-bottom: 8px;
      display: block;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 12px;
      background-color: rgba(255,255,255,0.9);
      transition: 0.3s border;
    }

    .form-group input:focus,
    .form-group select:focus {
      border-color: #3b82f6;
      outline: none;
    }

    #generateBtn {
      background: linear-gradient(135deg, #3b82f6, #6366f1);
      color: white;
      border: none;
      padding: 14px;
      font-size: 16px;
      border-radius: 12px;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
      transition: background 0.3s;
    }

    #generateBtn:hover {
      background: linear-gradient(135deg, #2563eb, #4f46e5);
    }

    .loader {
      display: none;
      margin: 15px auto;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #555;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0); }
      100% { transform: rotate(360deg); }
    }
    .output-container {
    /* ç§»é™¤å¯¼è‡´å…¨å±çš„æ ·å¼ */
    min-height: auto;           
    padding: 40px;              /* å‡å°‘å†…è¾¹è· */
    
    /* ä¿ç•™æ ¸å¿ƒå¸ƒå±€æ ·å¼ */
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    max-width: 800px;
    border-radius: 20px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
    color: #333;
    animation: fadeIn 0.6s ease;
    display: block;             /* æ¢å¤ä¸ºå—çº§å…ƒç´  */
    margin: 0 auto 60px;        /* æ°´å¹³å±…ä¸­+åº•éƒ¨é—´è· */
    max-height: 200vh; /* é™åˆ¶è¾“å‡ºåŒºæœ€å¤§é«˜åº¦ */
    overflow-y: auto; /* è¶…å‡ºé«˜åº¦æ˜¾ç¤ºæ»šåŠ¨æ¡ */
}

  .output-title {
    font-size: 1.6em;
    margin-bottom: 20px;
    color: #1e3a8a;
    border-bottom: 2px solid #90caf9;
    padding-bottom: 10px;
  }

  .output-content h1, .output-content h2, .output-content h3 {
    margin-top: 24px;
    margin-bottom: 10px;
    color: #2c3e50;
  }

  .output-content p {
    margin-bottom: 12px;
    line-height: 1.7;
    color: #444;
  }

  .output-content ul {
    padding-left: 20px;
    margin-bottom: 15px;
  }

  .output-content li {
    margin-bottom: 8px;
    line-height: 1.6;
  }

  .output-content a {
    color: #3b82f6;
    text-decoration: underline;
  }

  .output-content a:hover {
    color: #1d4ed8;
  }

  /* å…¬å…±æ ·å¼ */
.md-heading-box {
  border: 1px solid #ddd;
  background: #fafafa;
  padding: 0.6em 1em;
  border-radius: 0.6em;
  margin: 1em 0;
}
/* ä¸€çº§æ ‡é¢˜ä¸“å± */
.md-heading-1 {
  background: #e3f2fd;
  border-color: #90caf9;
}
/* äºŒçº§æ ‡é¢˜ä¸“å± */
.md-heading-2 {
  background: #fff3e0;
  border-color: #ffb74d;
}
/* è®©å†…éƒ¨çš„ h1ã€h2 æ ‡é¢˜å»æ‰åŸæœ‰å¤–è¾¹è· */
.md-heading-box h1,
.md-heading-box h2 {
  margin: 0;
}


  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
    </style>

  <!-- marked.js è§£æå™¨ -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <header>
    <nav>
      <div class="nav-container">
        <a href="#" class="logo">
          <div class="logo-icon"><i class="fas fa-book"></i></div>
          <span class="logo-text">å­¦ç¨‹é€š</span>
        </a>
        <div class="nav-links">
            <a href="main.html" class="nav-link home">
                <i class="fas fa-home"></i>é¦–é¡µ
            </a>
            <a href="zhuanzhu.html" class="nav-link focus">
                <i class="fas fa-clock"></i>ä¸“æ³¨æ¨¡å¼
            </a>
            <a href="generate.html" class="nav-link plan">
                <i class="fas fa-calendar-check"></i>ç”Ÿæˆè®¡åˆ’
            </a>
            <a href="login.html" class="nav-link login">
                <i class="fas fa-user-circle"></i>ç™»å½•
            </a>
        </div>
        <div class="mobile-toggle"><i class="fas fa-bars"></i></div>
      </div>
    </nav>
  </header>

  <!-- ä¸»ä½“å†…å®¹ï¼šç”Ÿæˆè®¡åˆ’è¡¨å• -->
  <div class="form-container">
    <h2 class="title">ğŸ“˜ ç”Ÿæˆä½ çš„ä¸“å±å­¦ä¹ è®¡åˆ’</h2>

    <div class="form-group">
      <label for="subject">å­¦ä¹ ç§‘ç›®</label>
      <input id="subject" placeholder="ä¾‹å¦‚ï¼šæ“ä½œç³»ç»Ÿã€çº¿æ€§ä»£æ•°â€¦" />
    </div>

    <div class="form-group">
      <label for="days">å­¦ä¹ å¤©æ•°</label>
      <input id="days" type="number" min="1" value="7" />
    </div>

    <div class="form-group">
      <label for="level">å­¦ä¹ ç›®æ ‡</label>
      <select id="level">
        <option value="å…¥é—¨">å…¥é—¨</option>
        <option value="ç²¾é€š">ç²¾é€š</option>
        <option value="ä¸“å®¶">ä¸“å®¶</option>
      </select>
    </div>

    <button id="generateBtn" onclick="generate()">ğŸ¯ ç”Ÿæˆè®¡åˆ’</button>
    <div class="loader" id="loader"></div>
  </div>

  <!-- è¾“å‡ºåŒºåŸŸï¼ˆä½ å¯ä»¥åœ¨è¿™é‡Œç¾åŒ–ï¼‰ -->
  <!-- è¾“å‡ºåŒºåŸŸ -->
<div class="output-container" id="output"></div>

<!-- è„šæœ¬é€»è¾‘ -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>

  // --------- å…¨å±€åªæ‰§è¡Œä¸€æ¬¡çš„åˆå§‹åŒ– ---------
  // 1) åˆ›å»ºä¸€ä¸ª Slugger ç”¨äºç”Ÿæˆ id
  const slugger = new marked.Slugger();

  // 2) åˆ›å»ºè‡ªå®šä¹‰ Renderer
  const renderer = new marked.Renderer();

  renderer.heading = (text, level, raw) => {
    // ä»…å¯¹ä¸€çº§ã€äºŒçº§æ ‡é¢˜åŒ…è£¹ä¸€ä¸ªå¸¦ç±»åçš„å®¹å™¨
    if (level === 1 || level === 2) {
      const id = slugger.slug(raw);
      return `
        <div class="md-heading-box md-heading-${level}">
          <h${level} id="${id}">${text}</h${level}>
        </div>
      `;
    }
    // å…¶ä»–æ ‡é¢˜æ­£å¸¸æ¸²æŸ“
    const id = slugger.slug(raw);
    return `<h${level} id="${id}">${text}</h${level}>\n`;
  };

  // 3) å‘Šè¯‰ marked ä½¿ç”¨ä¸Šé¢è¿™ä¸ª renderer
  marked.use({ renderer });


  function wrapHeadings(container) {
    // container æ˜¯ä½ å­˜æ”¾æ¸²æŸ“ç»“æœçš„ DOM èŠ‚ç‚¹ï¼Œæ¯”å¦‚ document.getElementById('output')
    // æˆ‘ä»¬è¦åœ¨å®ƒé‡Œé¢æ‰¾æ‰€æœ‰çš„ h1 å’Œ h2
    const headings = container.querySelectorAll('h1, h2');
    headings.forEach(h => {
      // è·³è¿‡å·²ç»åŒ…è¿‡çš„ï¼Œé¿å…é‡å¤åŒ…è£…
      if (h.parentElement.classList.contains('md-heading-box')) return;

      // åˆ›å»ºä¸€ä¸ª wrapper div
      const box = document.createElement('div');
      box.classList.add('md-heading-box', `md-heading-${h.tagName === 'H1' ? 1 : 2}`);

      // æŠŠ h èŠ‚ç‚¹æ¬è¿› boxï¼Œå†æŠŠ box æ’åˆ°åŸä½
      h.replaceWith(box);
      box.appendChild(h);
    });
  }

  // --------- ç”Ÿæˆå‡½æ•° ---------
  async function generate() {
    const subject = document.getElementById("subject").value.trim();
    const days    = parseInt(document.getElementById("days").value, 10);
    const level   = document.getElementById("level").value;
    const loader  = document.getElementById("loader");
    const output  = document.getElementById("output");

    // è¾“å…¥æ ¡éªŒ
    if (!subject || isNaN(days) || days <= 0) {
      alert("è¯·å¡«å†™å®Œæ•´ä¿¡æ¯ï¼");
      return;
    }

    // æ˜¾ç¤º loading
    loader.style.display = "block";
    output.innerHTML = "";

    try {
      const resp = await fetch("/api/generate_plan", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          user_id: localStorage.getItem("user_id"),
          subject,
          days,
          level
        })
      });

      if (!resp.ok) {
        throw new Error(`æœåŠ¡å™¨é”™è¯¯ï¼š${resp.status}`);
      }

      const data = await resp.json();
      const md   = data.plan_content;

      // æ¸²æŸ“å¹¶å¥—ä¸€å±‚ .output-contentï¼Œç¡®ä¿ CSS ç”Ÿæ•ˆ
      output.innerHTML = `
        <div class="output-content">
          ${marked.parse(md)}
        </div>
      `;
      wrapHeadings(output);

      // å­˜å‚¨ç”Ÿæˆè®°å½•
      localStorage.setItem('generatedPlan', JSON.stringify({ subject, days, level }));
    } catch (err) {
      console.error(err);
      output.innerHTML = `<p style="color: red;">ç”Ÿæˆå¤±è´¥ï¼š${err.message}</p>`;
    } finally {
      loader.style.display = "none";
    }
  }
  marked.parse()
</script>


</body>
</html>

